// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.30/esri/copyright.txt for details.

define(["dojo/_base/lang","../templateJsonUtils/fieldInfo/FieldInfoBuilder","esri/dijit/geoenrichment/ReportPlayer/core/sections/SectionTypes"],function(e,t,a){var i={};return i.createTable=function(a){var i=a.numColumns,n=a.numRows,l=a.width,r=a.widths,o=a.style,f=a.attributes&&a.attributes.fixedColumns,s=a.attributes&&a.attributes.dynamicColumns;if(l)if(r)r=r.map(function(e){return l*Number(e.replace("%",""))/100});else{var d=l/i;r=[];for(var u=0;u<i;u++)r.push(d)}if(r)l||isNaN(Number(r[0]))||(l=0,r.forEach(function(e){l+=e}));else{var c=Number(100/i).toFixed(3)+"%";r=[];for(var h=0;h<i;h++)r.push(c)}for(var m=[],p=0;p<i;p++)m.push({field:"field"+p,style:{width:r[p]}});for(var y=[],g=!0,v=a.height?a.height/n:a.rowHeight||15.07,b=0;b<n;b++){var S={style:{height:v,fields:{}},fieldInfos:{}};for(p=0;p<i;p++){var T="field"+p;!1!==a.useDefaultTheme&&(S.style.fields[T]=e.mixin({horizontalAlign:0===p?"left":"right",overrideStyle:0===b?n>1?!1!==a.useDefaultHeaderTheme?"TableHeader":"Default":void 0:g?"AlternatingRow":"Default"},a.cellParams)),s&&p>=f&&0===b&&(S.fieldInfos[T]=t.createFieldInfoFromSpecialFieldName("AREA_DESC")),a.processTableCell&&a.processTableCell(S,T,b,p,a)}y.push(S),g=!g}return{id:"table",attributes:e.mixin({},a.attributes),style:e.mixin({width:l||772.33},o),data:{columns:m,data:y}}},i.createSingleCellTable=function(e){e=e||{};var t=i.createTable({numColumns:1,numRows:1,attributes:e.attributes,useDefaultTheme:!1});return i.modifyTableJson(t,0,0,e),t},i.modifyTableJson=function(e,t,a,i){var n=e.data.data[t],l=e.data.columns[a],r=l.field;i.text&&(n[r]=i.text),i.fieldInfo&&(n.fieldInfos[r]=i.fieldInfo),i.cellStyle&&(n.style.fields[r]=i.cellStyle),i.columnSpan&&(n.columnSpans=n.columnSpans||{},n.columnSpans[r]=i.columnSpan),i.rowSpan&&(n.rowSpans=n.rowSpans||{},n.rowSpans[r]=i.rowSpan),n.themeStyle=i.themeStyle,i.width&&(e.style.width=i.width,l.style.width=i.width),i.height&&(n.style.height=i.height),void 0!==i.left&&(e.style.left=i.left),void 0!==i.spaceBefore&&(e.style.spaceBefore=i.spaceBefore)},i.getTableWidth=function(e){return e.style.width},i.getTableHeight=function(e){var t=0;return e.data.data.forEach(function(e){t+=e.style?e.style.height:0}),t},i.createDetailsSection=function(e){return{type:a.DETAILS,stack:[i.createTable(e)]}},i.createDetailsSectionForFieldInfos=function(t,n){return{type:a.DETAILS,stack:[function(){var a=i.createTable(e.mixin({numColumns:2,numRows:t.length+1},n));return a.data.data.forEach(function(e,a){if(0===a)return void(e.field0=t[0].hasVariable?t[0].fieldCategory:"");var i=t[a-1];e.field0=i.script?i.script.alias:i.alias,e.fieldInfos.field1=i}),i.provideSpaceAfter(a),a}()]}},i.createDetailsSectionForFieldInfoGroups=function(t,n){return{type:a.DETAILS,stack:[function(){var a=t[0],l=i.createTable(e.mixin({numColumns:t.length+1,numRows:a.length+1},n));return l.data.data.forEach(function(e,a){l.data.columns.forEach(function(i,n){if(0!==n){if(0===a)return void(e[i.field]=t[n-1][0].fieldCategory||"");var l=t[n-1][a-1];e.field0=e.field0||(l.script?l.script.alias:l.alias),e.fieldInfos[i.field]=l}})}),i.provideSpaceAfter(l),l}()]}},i.provideSpaceAfter=function(e,t){e.style.spaceAfter=Math.max(t||0,90-15.07*e.data.data.length)},i.applyDefaultStyling=function(e){var t=!0;e.data.data.forEach(function(a,i){e.data.columns.forEach(function(e){a.style.fields[e.field].overrideStyle=0===i?"TableHeader":t?"AlternatingRow":void 0}),t=!t})},i.setTableHeaderStyle=function(e){if(e.style)for(var t in e.style.fields){var a=e.style.fields[t]=e.style.fields[t]||{};a.overrideStyle="TableHeader"}},i.DEFAULT_ROW_HEIGHT=15.07,i.isMultiDataTable=function(e){return e.store?e.columns.length>1||e.store.data.length>2:e.data.columns.length>1||e.data.data.length>2},i.tableJsonHasInfographic=function(e){return!!i.getTableJsonInfographic(e)},i.getTableJsonInfographic=function(e){var t;return e.data.data.some(function(e){if(e.fieldInfos)for(var a in e.fieldInfos){var i=e.fieldInfos[a];if(i&&i.isInfographic)return t=i.infographicJson,!0}}),t},i.getTableJsonFirstFieldInfo=function(e){return e.data.data[0].fieldInfos[e.data.columns[0].field]},i.tableJsonHasChart=function(e){return e.data.data.some(function(e){if(e.fieldInfos)for(var t in e.fieldInfos){var a=e.fieldInfos[t];if(a&&a.isChart)return!0}})},i});