// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.30/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/on","dojo/string","esri/dijit/geoenrichment/when","dojo/dom-class","dojo/dom-construct","dijit/_WidgetBase","dijit/_TemplatedMixin","./PlayerSelect","./PlayerCommands","./PlayerThemes","./supportClasses/ToolbarArranger","./supportClasses/ZoomUtil","esri/dijit/geoenrichment/utils/DomUtil","esri/dijit/geoenrichment/utils/InvokeUtil","esri/dijit/geoenrichment/utils/MouseUtil","esri/dijit/geoenrichment/utils/PopupUtil","esri/dijit/geoenrichment/utils/TooltipUtil","dojo/text!./templates/PlayerToolbarHolder.html","dojo/i18n!esri/nls/jsapi"],function(t,o,e,i,n,s,a,l,r,h,c,u,d,p,m,f,g,T,S,b){b=b.geoenrichment.dijit.ReportPlayer.PlayerToolbar;var v=t([a,l],{templateString:S,nls:b,formatAreaTitleFunc:null,formatAreaTitleMultiFunc:null,showAreaTitle:!1,stretchToolbarNode:null,areasSelect:null,pageSelect:null,zoomSelect:null,_toolbarArranger:null,_infographicSelect:null,postCreate:function(){p.hide(this.commandButtonsContainer),this._toolbarArranger=new u({showAreaTitle:this.showAreaTitle,stretchToolbarNode:this.stretchToolbarNode,domNode:this.domNode,infographicsSelectDiv:this.infographicsSelectDiv,areaTitleDiv:this.areaTitleDiv,areaTitleInnerDiv:this.areaTitleInnerDiv,rightSideControlsBlock:this.rightSideControlsBlock,areasSelectDiv:this.areasSelectDiv,zoomSelectDiv:this.zoomSelectDiv,pageSelectDiv:this.pageSelectDiv,commandButtonsContainer:this.commandButtonsContainer}),this._initAreaSelect(),this._initPageSelect(),this._initZoomSelect(),T.autoTooltip(this.domNode)},_initAreaSelect:function(){var t=this;this.areasSelect=new r({onChange:function(o){t.onShowAnalysisAreaAt(o.value),t.onClosePopup()}}).placeAt(this.areasSelectDiv),this.own(this.areasSelect)},updateAreaSelect:function(t,o,e,i){var n=t.length,s=t.map(function(t,o){return{label:1===n?t.name:t.shortName||t.name||"",value:o}});if(this.areasSelect.set("options",s),this.areasSelect.set("value",e),p[n>1&&!i?"show":"hide"](this.areasSelectDiv),this._toolbarArranger.syncRightSideVisibility(),i)this.formatAreaTitleMultiFunc?this.formatAreaTitleMultiFunc(this.areaTitleInnerDiv,o):this._formatAreaTitleMulti(o);else{var a=t[e];this.formatAreaTitleFunc?this.formatAreaTitleFunc(this.areaTitleInnerDiv,a):this._formatAreaTitle(a)}},_formatAreaTitle:function(t){this.areaTitleInnerDiv.innerHTML=t.locationName||t.name},_formatAreaTitleMulti:function(t){this.areaTitleInnerDiv.innerHTML=t.locationName||t.name||t.shortName||""},_pageControlsVisible:!0,_initPageSelect:function(){var t=this;this.pageSelect=new r({onChange:function(o){t.onShowPageAt(o.value),t.onClosePopup()}}).placeAt(this.pageSelectDiv),this.own(this.pageSelect)},setPageControlsVisible:function(t){this._pageControlsVisible=t,p[t?"show":"hide"](this.pageSelectDiv)},updatePageSelect:function(t,o){for(var i=[],n=0;n<t;n++)i.push({label:e.substitute(b.pageIndex,{index:n+1}),value:n});this.pageSelect.set("options",i),this.pageSelect.set("value",o),p[this._pageControlsVisible&&t>1?"show":"hide"](this.pageSelectDiv)},_initZoomSelect:function(){var t=this;this.zoomSelect=new r({onChange:function(o){o.value===d.FIT_PAGE?t.onZoomToFitPage():o.value===d.FIT_PAGE_WIDTH?t.onZoomToFitPageWidth():o.value===d.FIT_PAGE_HEIGHT?t.onZoomToFitPageHeight():t.onSetZoomPercent(o.value),t.onClosePopup()}}).placeAt(this.zoomSelectDiv),this.own(this.zoomSelect),this.zoomSelect.set("options",d.getOptions()),this.zoomSelect.set("value",100)},setZoomSupportsInfo:function(t){p[t.supported?"show":"hide"](this.zoomSelectDiv),this._toolbarArranger.syncRightSideVisibility(),this.zoomSelect.store.data.forEach(function(o){o.hidden=!1,(o.value!==d.FIT_PAGE||t.canFitPage)&&(o.value!==d.FIT_PAGE_WIDTH||t.canFitPageWidth)&&(o.value!==d.FIT_PAGE_HEIGHT||t.canFitPageHeight)?(o.isCustomBig||o.isCustomSmall)&&(o.hidden=!o.value):o.hidden=!0})},setZoomInfo:function(t){var o=t.isFitPageScale?d.FIT_PAGE:t.isFitPageWidthScale?d.FIT_PAGE_WIDTH:t.isFitPageHeightScale?d.FIT_PAGE_HEIGHT:d.getClosestZoomAndUpdateOptions(100*t.scale,this.zoomSelect.get("options"));o!==this.zoomSelect.get("value")&&this.zoomSelect.set("value",o)},createCommandButton:function(t,o){return this.createCustomCommandButton({callback:o,buttonClass:t.id===h.PRINT?"playerPrintButton":"playerExportButton",tooltip:t.id===h.PRINT?b.printInfographic:b.exportInfographic,visibleOnError:!1})},createCustomCommandButton:function(t){p.show(this.commandButtonsContainer);var e=s.create("div",{class:"playerToolbar_commandButtonContainer dijitInline"},this.commandButtonsContainer,t.addFirst?"first":"last");e.__visibleOnError=t.visibleOnError;var i=s.create("div",{class:"playerToolbar_commandButton"},e);return t.buttonClass&&n.add(i,t.buttonClass),t.tooltip&&T.setTooltipToNode(i,t.tooltip),o(i,"click",t.callback),i},setTheme:function(t){n.remove(this.domNode,"playerThemeDark playerThemeLight"),n.add(this.domNode,t===c.DARK?"playerThemeDark":"playerThemeLight"),this.areasSelect.setTheme(t),this.pageSelect.setTheme(t),this.zoomSelect.setTheme(t)},setErrorShown:function(t){if(t){p.hide([this.areaTitleDiv,this.areasSelectDiv,this.pageSelectDiv,this.zoomSelectDiv]);for(var o=0;o<this.commandButtonsContainer.children.length;o++){var e=this.commandButtonsContainer.children[o];p[e.__visibleOnError?"show":"hide"](e)}this.arrangeControls()}},arrangeControls:function(){this._toolbarArranger.arrangeControls()},hasVisibleControls:function(){return this._toolbarArranger.hasVisibleControls()},addInfographicsSelect:function(t){this._infographicSelect=t,t.placeAt(this.infographicsSelectDiv)},isMouseOver:function(){return f.isMouseOver(this.domNode)||this.areasSelect&&this.areasSelect.isMouseOver()||this.pageSelect&&this.pageSelect.isMouseOver()||this.zoomSelect&&this.zoomSelect.isMouseOver()||this._infographicSelect&&this._infographicSelect.isMouseOver&&this._infographicSelect.isMouseOver()},setContentLoadPromise:function(t){p.enableContentAbsolute(this.commandButtonsContainer,!1),p.enableContentAbsolute(this.infographicsSelectDiv,!1),i(t,function(){p.enableContentAbsolute(this.commandButtonsContainer,!0),p.enableContentAbsolute(this.infographicsSelectDiv,!0)}.bind(this))},onShowPageAt:function(t){},onShowAnalysisAreaAt:function(t){},onZoomToFitPage:function(){},onZoomToFitPageWidth:function(){},onZoomToFitPageHeight:function(){},onSetZoomPercent:function(t){},onClosePopup:function(){}});return t([a,l],{templateString:"<div class='esriGEPlayerToolbarOuter'></div>",popupButtonDiv:null,formatAreaTitleFunc:null,formatAreaTitleMultiFunc:null,showToolbarInPopup:!1,showAreaTitle:!1,stretchToolbarNode:null,isMobileDevice:!1,showCloseButton:!1,toolbarHolder:null,postCreate:function(){var t=this;this.inherited(arguments),this.toolbarHolder=new v({showAreaTitle:this.showAreaTitle,stretchToolbarNode:this.stretchToolbarNode,onShowPageAt:function(o){t.onShowPageAt(o)},onShowAnalysisAreaAt:function(o){t.onShowAnalysisAreaAt(o)},onZoomToFitPage:function(){t.onZoomToFitPage()},onZoomToFitPageWidth:function(){t.onZoomToFitPageWidth()},onZoomToFitPageHeight:function(){t.onZoomToFitPageHeight()},onSetZoomPercent:function(o){t.onSetZoomPercent(o)},onClosePopup:function(){t.closePopup()}}).placeAt(this.domNode),this.own(this.toolbarHolder)},updateAreaSelect:function(t,o,e,i){this.toolbarHolder.formatAreaTitleFunc=this.formatAreaTitleFunc,this.toolbarHolder.formatAreaTitleMultiFunc=this.formatAreaTitleMultiFunc,this.toolbarHolder.updateAreaSelect(t,o,e,i)},setPageControlsVisible:function(t){this.toolbarHolder.setPageControlsVisible(t)},updatePageSelect:function(t,o){this.toolbarHolder.updatePageSelect(t,o)},setZoomSupportsInfo:function(t){this.toolbarHolder.setZoomSupportsInfo(t)},setZoomInfo:function(t){this.toolbarHolder.setZoomInfo(t)},createCommandButton:function(t,o){return this.toolbarHolder.createCommandButton(t,o)},setTheme:function(t){this.toolbarHolder.setTheme(t)},setErrorShown:function(t){this.toolbarHolder.setErrorShown(t)},_popupHandle:null,_popupButton:null,update:function(){m.invoke(this,"_doUpdateToolbar")},_doUpdateToolbar:function(){n[this.isScrollShown()?"add":"remove"](this.popupButtonDiv,"playerToolbar_parentHasScroll"),n[this.isMobileDevice?"add":"remove"](this.popupButtonDiv,"isMobileDevice"),n[this.isMobileDevice?"add":"remove"](this.toolbarHolder.domNode,"isMobileDevice"),this._resetToolbarNode();var t=g.isOpen(this.toolbarHolder);this._popupHandle&&this._popupHandle.remove(),this._popupHandle=null,this.showToolbarInPopup?(this._popupButton=s.create("div",{class:"dijitInline playerToolbar_outerButton playerToolbar_settingsButton"},this.popupButtonDiv,"first"),this._popupHandle=g.makePopup(this.toolbarHolder,this,this._popupButton,{orient:["before","below"],openPopup:t})):s.place(this.toolbarHolder.domNode,this.domNode),this.toolbarHolder.arrangeControls(),p[this.toolbarHolder.hasVisibleControls()?"show":"hide"]([this._popupButton,this.domNode])},_resetToolbarNode:function(){this.toolbarHolder.domNode.parentNode&&this.toolbarHolder.domNode.parentNode.removeChild(this.toolbarHolder.domNode),s.empty(this.domNode),this._popupButton&&s.destroy(this._popupButton),this._popupButton=null},closePopup:function(){this.showToolbarInPopup&&g.close(this.toolbarHolder)},isScrollShown:function(){return!1},placeInfographicsSelect:function(t){t.placeAt(this.toolbarHolder.infographicsSelectDiv)},createCustomCommandButton:function(t){return this.toolbarHolder.createCustomCommandButton(t)},notifyCommandButtonsAdded:function(){if(this.showCloseButton)if(this.showToolbarInPopup){var t=s.create("div",{class:"dijitInline playerToolbar_outerButton playerToolbar_closeButtonOuter"},this.popupButtonDiv);T.setTooltipToNode(t,b.close),o(t,"click",function(){this.onClose()}.bind(this))}else this.createCustomCommandButton({buttonClass:"playerToolbar_closeButton",tooltip:b.close,callback:function(){this.closePopup(),this.onClose()}.bind(this),visibleOnError:!0})},addInfographicsSelect:function(t){this.toolbarHolder.addInfographicsSelect(t)},isMouseOver:function(){return f.isMouseOver(this.domNode)||this.toolbarHolder.isMouseOver()},setContentLoadPromise:function(t){this.toolbarHolder.setContentLoadPromise(t)},onShowPageAt:function(t){},onShowAnalysisAreaAt:function(t){},onZoomToFitPage:function(){},onZoomToFitPageWidth:function(){},onZoomToFitPageHeight:function(){},onSetZoomPercent:function(t){},onClose:function(){}})});