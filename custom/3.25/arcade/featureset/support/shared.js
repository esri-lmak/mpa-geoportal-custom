// COPYRIGHT Â© 201 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.30/esri/copyright.txt for details.

define(["require","exports","../../polyfill/promiseUtils","../../../geometry/Extent","../../../layers/Field"],function(e,t,n,r,o){"use strict";function i(e){return new o(u(e))}function u(e){var t=null;return e.domain&&(t="range"===e.domain.type?{type:"range",range:[e.domain.minValue,e.domain.maxValue]}:{type:"codedValue",codedValues:e.domain.toJson().codedValues}),{name:e.name,type:e.type,alias:e.alias,length:e.length,editable:e.editable,nullable:e.nullable,domain:t}}function l(e){return"string"==typeof e||e instanceof String}function a(e){return"boolean"==typeof e}function s(e){return"number"==typeof e}function c(e){return e instanceof Array}function y(e){return e instanceof Date}function f(e,t){return e===t||!(!y(e)||!y(t))&&e.getTime()===t.getTime()}function p(e){var t={};for(var n in e)t[n]=e[n];return t}function m(e){if(void 0===e)return null;if("number"==typeof e)return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null}function d(e){if(null===e)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.getExtent();case"point":return new r({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function v(e){if(void 0===e)return null;if("number"==typeof e)return e;if("number"==typeof e)return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null}function g(e,t){return e===t||("point"===e&&"esriGeometryPoint"===t||("polyline"===e&&"esriGeometryPolyline"===t||("polygon"===e&&"esriGeometryPolygon"===t||("extent"===e&&"esriGeometryEnvelope"===t||("multipoint"===e&&"esriGeometryMultipoint"===t||("point"===t&&"esriGeometryPoint"===e||("polyline"===t&&"esriGeometryPolyline"===e||("polygon"===t&&"esriGeometryPolygon"===e||("extent"===t&&"esriGeometryEnvelope"===e||"multipoint"===t&&"esriGeometryMultipoint"===e)))))))))}function G(e){return function(t){e.reject(t)}}function S(e,t){return function(n){try{e.apply(null,arguments)}catch(e){t.reject(e)}}}function b(e){switch(e){case"point":return"esriGeometryPoint";case"polygon":return"esriGeometryPolygon";case"multipoint":return"esriGeometryMultipoint";case"polyline":return"esriGeometryPolyline";default:return"esriGeometryPoint"}}function x(e,t,r){return n.create(function(r,o){var i=n.resolve(!0);e.reduce(function(e,r,o,i){return e.then(function(e){try{return t(e,r,o,i)}catch(e){return n.reject(e)}},function(e){return n.reject(e)})},i).then(r,o)})}function P(e){return void 0===e?"":(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer"),e=e.replace(/\/mapserver\/[0-9]*/i,"/MapServer"),e=e.split("?")[0])}function h(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var n="boolean"==typeof t.cycles&&t.cycles,r=t.cmp&&function(e){return function(t){return function(n,r){var o={key:n,value:t[n]},i={key:r,value:t[r]};return e(o,i)}}}(t.cmp),o=[];return function e(t){if(t&&t.toJson&&"function"==typeof t.toJson&&(t=t.toJson()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var i,u;if(Array.isArray(t)){for(u="[",i=0;i<t.length;i++)i&&(u+=","),u+=e(t[i])||"null";return u+"]"}if(null===t)return"null";if(-1!==o.indexOf(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=o.push(t)-1,a=Object.keys(t).sort(r&&r(t));for(u="",i=0;i<a.length;i++){var s=a[i],c=e(t[s]);c&&(u&&(u+=","),u+=JSON.stringify(s)+":"+c)}return o.splice(l,1),"{"+u+"}"}}(e)}Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"}(t.FeatureServiceDatabaseType||(t.FeatureServiceDatabaseType={})),t.cloneField=i,t.esriFieldToJson=u;!function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(t.IdState||(t.IdState={})),t.isString=l,t.isBoolean=a,t.isNumber=s,t.isArray=c,t.isDate=y,t.equalityTest=f,t.cloneAttributes=p,t.convertSquareUnitsToCode=m,t.shapeExtent=d,t.convertLinearUnitsToCode=v,t.sameGeomType=g,t.defaultMaxRecords=1e3,t.errback=G,t.callback=S,t.layerGeometryEsriConstants={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},t.toEsriGeometryType=b,t.reduceArrayWithPromises=x,t.extractServiceUrl=P,t.stableStringify=h});